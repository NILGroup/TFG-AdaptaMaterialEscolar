%---------------------------------------------------------------------%
%																	  %
%               Capítulo 5 - AdaptaMaterialEscolar			  	  	  %
%																	  %
%---------------------------------------------------------------------%

\chapter{AdaptaMaterialEscolar}


\begin{resumen}
	En este capítulo se explicará, en la sección \ref{cap5:sec:capturaRequisitos}, para quién va a desarrollarse el proyecto de AdaptaMaterialEscolar y el proceso de captura de requisitos. En la sección \ref{cap5:sec:diseño}, se explicará cómo se diseñó la aplicación a partir de los requisitos. Por último, en la sección \ref{cap5:sec:implementacion}, se mostrará cómo se ha implementado la aplicación. 
\end{resumen}


%------Primera sección: Captura de requisitos------%
\section{Requisitos de la aplicación}
%--------------------------------------------------%
\label{cap5:sec:capturaRequisitos}

El Trabajo de Fin de Grado de AdaptaMaterialEscolar es un proyecto sin ánimo de lucro que ha sido desarrollado con la colaboración de  las profesoras del Aula TEA del IES Maestro Juan de Ávila de Ciudad Real.

Para su implementación, debido a que se pretende que el proyecto sea realmente útil para los docentes, se hizo una amplia captura de requisitos con los usuarios finales, de forma que se pudieron conocer las necesidades reales de un centro educativo, siguiendo un Diseño Centrado en el Usuario.

Se realizaron una serie de reuniones con los usuarios finales, tanto presenciales como online, para obtener los requisitos de la aplicación; además, se mantuvo el contacto con ellos durante todo el proceso de diseño e implementación, para irles enseñando la evolución de la aplicación.	

\subsection{Captura de requisitos}

El 25 de julio de 2019 se organizó una primera reunión presencial con las dos profesoras que forman parte del Aula TEA en el IES Maestro Juan de Ávila: Ana María Alonso Frades, especialista en Pedagogía Terapéutica y Ana María Díaz Valle, especialista en Audición y Lenguaje. 

Las profesoras nos hablaron sobre los diferentes perfiles de alumnos TEA con los que trabajaban en el centro y explicaron la importancia de contar con una aplicación especializada en adaptaciones curriculares, que fuera flexible y permitiera generar diferentes modelos de temario, actividades y exámenes con el menor esfuerzo posible. El proyecto debía poder convertir un mismo párrafo o ejercicio en otro más sencillo de comprender, asimilar o resolver, de forma que pudiera personalizarse para cada alumno de acuerdo a su capacidad cognitiva y así facilitarles el aprendizaje sin excluir temario.

A pesar de que hay unas pautas a seguir para adaptar el temario, las actividades y los exámenes (por ejemplo usar letra grande e imágenes), no hay un estándar definido que sigan todos los profesores, y a algunos alumnos les resulta confuso el cambio de una asignatura a otra.

Después de hablar con las profesoras y conocer a un alumno TEA que nos explicó su rutina en el instituto, vimos un ejemplo de tema y examen adaptado de Ciencias Naturales. 

En este punto, a partir de la información proporcionada por los usuarios finales, se tomaron las siguientes decisiones: 

\begin{itemize}
	\item Tipo de aplicación: Inicialmente las profesoras plantearon desarrollar una aplicación de escritorio que pudieran instalar tanto en los ordenadores del centro, como en los suyos propios, pero se tuvo en cuenta que probablemente no todo el profesorado contaría con un ordenador personal con el que poder trabajar desde casa. Por ello, se tomó la decisión de desarrollar el proyecto como aplicación web, de manera que se pudiera utilizar desde cualquier dispositivo con acceso a Internet.
	\item Registro: Las profesoras indicaron que era mejor no tener que registrarse en la aplicación para poder trabajar con ella, ya que se consideró que no era conveniente almacenar usuarios ni contraseñas para evitar que los profesores tuvieran que utilizar datos personales con los que identificarse.
\end{itemize}

A partir de ahí, como resultado de la reunión, obtuvimos las funcionalidades de la aplicación. Presentamos estas funcionalidades agrupadas en: adaptaciones de temario, actividades y/o exámenes y
 formato.

\label{cap5:sec:capturaRequisitos:tiposAdaptaciones}

\underline{Adaptaciones de temario}

La motivación de las adaptaciones de temario es conseguir, en el menor tiempo posible, una unidad didáctica teórica adaptada al alumno de forma casi inmediata y automática, seleccionando el texto a convertir. En este sentido, la aplicación debe ofrecer al usuario la posibilidad de:
\begin{itemize}
	\item Generar un resumen a partir de un texto.
	\item Crear esquemas que faciliten la visualización del temario y/o las actividades, seleccionando contenido de un texto ya redactado o escribiendo desde cero.
	\item Crear tablas que organicen el temario y/o las actividades, seleccionando contenido de un texto ya redactado o escribiendo desde cero.
\end{itemize}

\underline{Adaptaciones de actividades y/o exámenes}:

La motivación de las adaptaciones de actividades y/o exámenes es conseguir unidades didácticas prácticas o actividades de forma fácil, seleccionando texto o un ejercicio ya redactado y adaptándolo de forma automática al tipo de ejercicio que se quiere obtener, añadiendo enunciados y ejemplos (con o sin pictogramas), siempre que sea posible, donde se explique cómo debe resolverse el ejercicio. La aplicación debe permitir crear los siguientes tipos de ejercicios:
\begin{itemize}
	\item Ejercicios de relacionar contenido mediante flechas.
	\item Ejercicios de sopa de letras.
	\item Ejercicios de completar espacios en un texto.
	\item Ejercicios de desarrollo en un espacio limitado para escribir.
	\item Ejercicios de verdadero o falso.
	\item Ejercicios de completar los espacios en blanco en tablas.
	\item Ejercicios de completar los espacios en blanco en esquemas.
\end{itemize}

Además, todos los ejercicios que se creen deben permitir añadir ejemplos (con o sin pictogramas) explicando cómo debe resolverse el ejercicio.

\underline{Adaptaciones de formato}:

Las adaptaciones de formato deben permitir estandarizar cualquier documento que se vaya a entregar al alumno, de manera que el cambio de una asignatura a otra no suponga un cambio visual y el aprendizaje sea menos costoso. Nuestra aplicación debe permitir al usuario final que, dado un texto, pueda:

\begin{itemize}
	\item Sustituir una palabra por un pictograma.
	\item Sustituir una palabra por una imagen.
	\item Subrayar una palabra con un color, para que los alumnos visualicen cada una de las palabras resaltadas en el texto con mayor facilidad.
	\item Añadir una  leyenda de colores con la categoría de cada tipo de palabra resaltada, para que los alumnos puedan identificar el significado de cada una de las palabras resaltadas en el texto.
	\item Añadir leyenda de colores para diferenciar las asignaturas, para que los alumnos relacionen cada asignatura con un color determinado y cambien de clase sin confundirse.
	\item Estandarizar formato en textos, estableciendo una fuente de texto determinada y un tamaño acorde para cada alumno.
	\item Estandarizar formato para títulos e índices del temario, generando de forma automática una plantilla del color de la asignatura.
	\item Aumentar el tamaño de la fuente de una parte del texto.
	\item Subrayar una parte del texto.
	\item Poner en negrita una parte del texto.
	\item Añadir imágenes buscando una palabra en bases de datos de imágenes libres.
\end{itemize}

\subsection{Análisis de requisitos}

Una vez recopilados los requisitos del proyecto, redactamos una lista con éstos para que pudiéramos, tanto las profesoras del Aula TEA como el equipo de desarrollo, analizarlos de forma independiente, para no influir en la toma de decisiones sobre la importancia y dificultad de cada funcionalidad.

Enviamos el listado de requisitos a las profesoras por correo electrónico, con la finalidad de que revisaran el contenido o añadieran nuevas funcionalidades si fuera necesario y evaluaran cada uno de ellos. Las profesoras Ana María Alonso Frades y Ana María Díaz Valle debían puntuar los requisitos según la utilidad que pudieran aportar cada uno de ellos a su trabajo. Las posibles puntuaciones debían ir de uno a tres, siendo el uno poco importante, el dos importante y el tres imprescindible. Prácticamente todos los requisitos fueron puntuadas como imprescindible, por lo que quedó claro que el proyecto cubre una necesidad real y no añadieron ningún requisito más.

Por otro lado, cada miembro del equipo de desarrollo puntuó los requisitos de manera individual, para no influir en la decisión de los compañeros, según la dificultad que consideraban que tendría la implementación de cada requisito a nivel técnico. Las posibles puntuaciones debían ir de uno a tres, siendo el uno difícil, el dos intermedio y el tres fácil. 

La finalidad de este análisis de los requisitos era obtener un listado con las funcionalidades ordenadas por dificultad e importancia. Con la puntuación que asignaron las profesoras de forma conjunta, se obtuvo el indicador de importancia de cada tarea y, con la media de las puntuaciones del equipo de desarrollo, el indicador de dificultad.

La tabla resultante ordena, de forma descendente, las puntuaciones obtenidas de la multiplicación de los indicadores de importancia y dificultad, siendo 9 la máxima calificación y 1 la mínima. Para establecer un orden en el desarrollo de los requisitos, se considera más prioritaria la implementación de las funcionalidades con puntuación 9 (imprescindibles y fáciles de implementar) y las menos prioritarias serán aquellas con puntuación 1 (funcionalidades poco importantes y difíciles de implementar). En la Tabla \ref{tabla:cap5:sec:segundaIteracionTablaRequisitos1} se muestra el listado final de las funcionalidades, agrupadas por tipo de adaptación, con la media de las puntuaciones obtenidas.

El resultado final se separó en dos tablas. La primera, la Tabla \ref{tabla:cap5:sec:segundaIteracionTablaOrdenFuncionalidades}, contiene las funcionalidades de la aplicación: las adaptaciones de temario (T) y actividades y/o exámenes (A), y la segunda, la Tabla \ref{tabla:cap5:sec:segundaIteracionTablaOrdenPersonalizacion}, contiene las adaptaciones de formato (F) que serían necesarias en el proyecto.


\begin{table}
	\begin{adjustbox}{center}
	\centering
	\scalebox{0.82}{
			\begin{tabular}{p{9cm} p{2cm} p{2cm}}
			\hline
			\multicolumn{1}{| c |}{\textbf{ADAPTACIONES DE TEMARIO (T)}} & \multicolumn{2}{| c |}{\textbf{Evaluación}} \\ \hline
			\textbf{Requisito} &\textbf{Imp.} & \textbf{Dif.}\\ \hline
			Generar un resumen a partir de un texto & 3 & 2\\ \hline
			Crear esquemas que faciliten la visualización del temario y/o las actividades, seleccionando contenido de un texto ya redactado o escribiendo desde cero & 3 & 1,7 \\ \hline
			Crear tablas que organicen el temario y/o las actividades, seleccionando contenido de un texto ya redactado o escribiendo desde cero & 2 & 1,7 \\ \hline
			\multicolumn{1}{| c |}{\textbf{ADAPTACIONES DE ACTIVIDADES (A)}} & \multicolumn{2}{| c |}{\textbf{Evaluación}} \\ \hline
			\textbf{Requisito} &\textbf{Imp.} & \textbf{Dif.}\\ \hline
			Ejercicios de relacionar contenido mediante flechas & 3 & 2 \\ \hline
			Ejercicios de sopa de letras & 2 & 3 \\ \hline
			Ejercicios de completar espacios en un texto & 3 & 2,7\\ \hline
			Ejercicios de desarrollo en un espacio limitado para escribir& 3 & 2,7\\ \hline
			Ejercicios de verdadero o falso & 3 & 3 \\ \hline
			Ejercicios de completar los espacios en blanco en tablas & 3 & 2 \\ \hline
			Ejercicios de completar los espacios en blanco en esquemas & 3 & 1 \\ \hline
			Añadir enunciados y ejemplos (con o sin pictogramas), donde se explique cómo debe resolverse el ejercicio & 2 & 3 \\ \hline
			\multicolumn{1}{| c |}{\textbf{ADAPTACIONES DE FORMATO I (F)}} & \multicolumn{2}{| c |}{\textbf{Evaluación}} \\ \hline
			\textbf{Requisito} &\textbf{Imp.} & \textbf{Dif.}\\ \hline
			Sustituir una palabra por un pictograma & 2 & 2,7 \\ \hline
			Sustituir una palabra por una imagen & 2 & 2,3 \\ \hline
			Resaltar una palabra con un color & 3 & 3  \\ \hline
			Añadir una  leyenda de colores con la categoría de cada tipo de palabra resaltada, para que los alumnos puedan identificar el significado de cada una de las palabras resaltadas en el texto & 1 & 3 \\ \hline
			Añadir leyenda de colores para diferenciar las asignaturas, para que los alumnos relacionen cada asignatura con un color determinado y cambien de clase sin confundirse & 1 & 3 \\ \hline
			Estandarizar formato en textos, estableciendo una fuente de texto determinada y un tamaño acorde para cada alumno & 3 & 2 \\ \hline
			Estandarizar formato para títulos e índices del temario, generando de forma automática una plantilla del color de la asignatura & 3 & 2 \\ \hline
			Aumentar el tamaño de la fuente de una parte del texto & 3 & 2,7 \\ \hline
			Subrayar una parte del texto & 2 & 2,7 \\ \hline
			Poner en negrita una parte del texto & 3 & 2,7 \\ \hline
			Añadir imágenes buscando una palabra en bases de datos de imágenes libres & 3 & 2,3 \\ \hline
			\multicolumn{1}{| c |}{\textbf{ADAPTACIONES DE FORMATO II (F)}} & \multicolumn{2}{| c |}{\textbf{Evaluación}} \\ \hline
			\textbf{Requisito} &\textbf{Imp.} & \textbf{Dif.}\\ \hline
			Añadir espacio extra entre líneas para escribir & 3 & 2\\ \hline
		\end{tabular}
	}
	\end{adjustbox}
	\caption{Puntuación de los requisitos creada por los docentes (Importancia) y los desarrolladores (Dificultad).}
	\label{tabla:cap5:sec:segundaIteracionTablaRequisitos1}
\end{table}

\begin{table}
	\begin{adjustbox}{center}
	\centering
	\scalebox{0.82}{
			\begin{tabular}{p{1cm} p{8cm} p{3cm}}
			\hline
			\textbf{Tipo} & \textbf{Requisito} & \textbf{Puntuación}\\ \hline
			\textbf{A} & Ejercicios de verdadero o falso & \textbf{9} \\ \hline
			\textbf{A} & Ejercicios de completar espacios en un texto & \textbf{8,1} \\ \hline
			\textbf{A} & Ejercicios de desarrollo en un espacio limitado para escribir & \textbf{8,1} \\ \hline
			\textbf{T} & Generar un resumen a partir de un texto & \textbf{6} \\ \hline
			\textbf{A} & Ejercicios de relacionar contenido mediante flechas & \textbf{6} \\ \hline
			\textbf{A} & Ejercicios de sopas de letras & \textbf{6} \\ \hline
			\textbf{A} & Añadir ejemplos (con o sin pictogramas) sobre cómo resolver el ejercicio & \textbf{6} \\ \hline
			\textbf{A} & Ejercicios de completar los espacios en blanco en tablas & \textbf{6} \\ \hline
			\textbf{T} & Crear esquemas que faciliten la visualización del temario y/o las actividades, seleccionando contenido de un texto ya redactado o escribiendo desde cero & \textbf{5,1} \\ \hline
			\textbf{T} & Crear tablas que organicen el temario y/o las actividades, seleccionando contenido de un texto ya redactado o escribiendo desde cero & \textbf{3,4} \\ \hline
			\textbf{A} & Ejercicios de completar los espacios en blanco en esquemas & \textbf{3} \\ \hline
		\end{tabular}
	}
	\end{adjustbox}
	\caption{Lista de funcionalidades relacionadas con adaptaciones de temario (T) y crear actividades (A), ordenada por prioridad.}
	\label{tabla:cap5:sec:segundaIteracionTablaOrdenFuncionalidades}
\end{table}

\begin{table}
	\begin{adjustbox}{center}
		\centering
		\scalebox{0.82}{
			\begin{tabular}{p{1cm} p{8cm} p{3cm}}
				\hline
				\textbf{Tipo} & \textbf{Requisito} & \textbf{Puntuación}\\ \hline
				\textbf{F} & Resaltar una palabra con un color & \textbf{9} \\ \hline
				\textbf{F} & Aumentar el tamaño de la fuente de una parte del texto & \textbf{8,1} \\ \hline
				\textbf{F} & Poner en negrita una parte del texto & \textbf{8,1} \\ \hline
				\textbf{F} & Añadir imágenes buscando una palabra en bases de datos de imágenes libres & \textbf{6,9} \\ \hline
				\textbf{F} & 
				Añadir enunciados y ejemplos (con o sin pictogramas), donde se explique cómo debe resolverse el ejercicio & \textbf{6} \\ \hline
				\textbf{F} & Estandarizar formato para títulos e índices del temario, generando de forma automática una plantilla del color de la asignatura & \textbf{6} \\ \hline
				\textbf{F} & Estandarizar formato en textos, estableciendo una fuente de texto determinada y un tamaño acorde para cada alumno & \textbf{6} \\ \hline
				\textbf{F} & Añadir espacio extra entre líneas para escribir & \textbf{6} \\ \hline
				\textbf{F} & Sustituir una palabra por un pictograma & \textbf{5,4} \\ \hline
				\textbf{F} & Subrayar una parte del texto & \textbf{5,4} \\ \hline
				\textbf{F} & Añadir una  leyenda de colores con la categoría de cada tipo de palabra resaltada, para que los alumnos puedan identificar el significado de cada una de las palabras resaltadas en el texto & \textbf{3} \\ \hline
			\end{tabular}
		}
	\end{adjustbox}
	\caption{Lista de funcionalidades de adaptación de formato, ordenada por prioridad.}
	\label{tabla:cap5:sec:segundaIteracionTablaOrdenPersonalizacion}
\end{table}


\subsection{Requisitos adicionales}

El miércoles 4 de diciembre de 2019, el grupo de investigación NIL (Natural Interaction based on Language) organizó un workshop en la Facultad de Informática de la Universidad Complutense con docentes de otros centros y asociaciones. Durante este workshop se mostraron las herramientas tecnológicas inclusivas que se habían desarrollado o que se encontraban en desarrollo, siendo una de las presentadas AdaptaMaterialEscolar.

Un miembro del equipo de desarrollo, Jorge Velasco Conde, realizó una presentación en la que explicó a los asistentes el funcionamiento y la finalidad de nuestro proyecto, con ejemplos visuales sobre posibles adaptaciones que podrían llegar a realizarse. Después de la presentación se realizó una ronda de opiniones con todos los docentes y expertos, para que pudieran expresar qué les había parecido la propuesta. Todos los comentarios fueron muy positivos y preguntaron cuándo estaría disponible para uso público. Además de dar un feedback positivo sobre el proyecto, también propusieron un nuevo tipo de adaptación de formato, para mejorar las opciones de personalización para los alumnos. El requisito consiste en aportar un espacio lo suficientemente grande, ampliando la distancia entre los renglones si es necesario, para que los alumnos que tienen una letra de mayor tamaño puedan escribir sin problema.

En este caso únicamente realizamos la evaluación del requisito los desarrolladores, ya que, al ser una petición, se consideró que el indicador de importancia debía tener la máxima puntuación, para poder aportar utilidad a un mayor número de centros y asociaciones y el indicador de dificultad volvió a calcularse de forma independiente entre el equipo, haciendo la media entre las puntuaciones. El requisito se encuentra anexado en la Tabla \ref{tabla:cap5:sec:segundaIteracionTablaRequisitos1} y en la Tabla \ref{tabla:cap5:sec:segundaIteracionTablaOrdenPersonalizacion} se puede ver la puntuación.


%------Última sección: Diseño de la aplicación------%
\section{Diseño de la aplicación}
%---------------------------------------------------%
\label{cap5:sec:diseño}

	El diseño de la aplicación web se ha desarrollado en varias iteraciones. En la primera iteración se creó un boceto de la aplicación en papel. En la segunda iteración se mejoró ese boceto, creando un prototipo por vistas a través de la herramienta online \textit{Moqups} (ver sección \ref{cap3:sec:moqups}). En la tercera iteración cada uno de los miembros del equipo creó su propio prototipo, sin influir los unos con los otros, para ver si el prototipo creado con \textit{Moqups} podía ser mejorado. En la última iteración se realizó el diseño final de la aplicación. En las siguientes secciones se dan más detalles sobre estas iteraciones.
	
	\subsection{Primera iteración: boceto inicial}
	\label{cap5:sec:diseño:subsec:primera}
		Para comenzar el proceso de diseño se creó un boceto en papel de la página principal de la aplicación (Figura \ref{fig:bocetoInicial}). En la parte superior de este diseño, se observa que hay una barra de navegación con dos menús: Texto y Actividades. Cada uno de ellos tiene un submenú con las diferentes adaptaciones disponibles para dicho menú (en la sección \ref{cap5:sec:capturaRequisitos:tiposAdaptaciones} se pueden ver las diferentes adaptaciones que habrá en la aplicación). En el lado derecho encontramos otro menú con dos zonas diferenciadas: en la parte superior tenemos los botones de Subir texto (que sube un fichero en formato \textit{.pdf} o \textit{.docx}) y Descargar (que descarga el documento adaptado en formato \textit{.pdf}). En la parte inferior del menú lateral, nos encontramos un Resaltar información, el cual sirve para dar formato a los títulos, al cuerpo, etc. Por último, en el centro de la página, se encuentra el fichero subido con el que podremos seleccionar textos y poder adaptarlos conforme así se requiera.
		
		\begin{figure}[ht!]
			\begin{center}
				\includegraphics[scale=0.6, angle=90]{Imagenes/Bitmap/bocetoInicial}
				\caption{Boceto inicial de la aplicación}
				\label{fig:bocetoInicial}
			\end{center}
		\end{figure}
	
	\subsection{Segunda iteración: versión 1.0 del prototipo}
	\label{cap5:sec:diseño:subsec:segunda}
		Partiendo del diseño inicial, y a través de la herramienta \textit{Moqups} (ver sección \ref{cap3:sec:moqups}), se creó un prototipo más amplio por vistas:
		\begin{itemize}
			\item \textbf{Página principal}: En la Figura \ref{fig:paginaInicialProtoConjunto} se puede ver la página principal de la aplicación. Ésta es la página que se vería nada más entrar. En la parte superior, encontramos dos barras de navegación con diferentes menús. En la barra de navegación superior, podemos ver los menús relacionados con un editor de texto: Archivo, Edición, Formato, Insertar y Ayuda. En la barra de navegación inferior se encuentran los menús correspondientes a las adaptaciones de Temario y Actividades, además de la posibilidad de buscar imágenes libres\footnote{Las imágenes libres son aquellas imágenes que son de dominio público y que no tienen derechos reservados.} (también llamadas imágenes \textit{CC0} o \textit{Creative Commons Zero}\footnote{https://creativecommons.org/publicdomain/zero/1.0/deed.es}) y pictogramas. En el centro de la página web, podemos observar dos elementos: el logo de la aplicación AdaptaMaterialEscolar y una zona para poder subir el fichero en formato \textit{.pdf} o \textit{.docx}, ya sea seleccionándolo de una carpeta o arrastrando desde la carpeta a la zona de subida.
			
			\begin{figure}[ht!]
				\begin{center}
					\includegraphics[width=0.84\textwidth]{Imagenes/Bitmap/paginaInicialProtoConjunto}
					\caption{Versión 1.0 de la página principal}
					\label{fig:paginaInicialProtoConjunto}
				\end{center}
			\end{figure}
		
			\item \textbf{Editor}: Una vez subido el fichero se pasa a la vista del editor. En la Figura \ref{fig:editorProtoConjunto} se puede observar dicha vista. En ésta, encontramos en la parte superior las dos barras de navegación descritas en el punto anterior. En el centro de la página observamos dos elementos: el elemento de la izquierda es el fichero subido, donde se podrán seleccionar las partes del texto que se quieran adaptar. El elemento de la derecha es el editor donde se podrá, también, adaptar e insertar imágenes, pictogramas, dar formato, etc.

			\begin{figure}[htp!]
				\begin{center}
					\includegraphics[width=0.84\textwidth]{Imagenes/Bitmap/editorProtoConjunto}
					\caption{Versión 1.0 del editor}
					\label{fig:editorProtoConjunto}
				\end{center}
			\end{figure}
			
			\item \textbf{Búsqueda de pictogramas}: En la Figura \ref{fig:buscarPictoProtoConjunto} se puede ver la búsqueda de pictogramas. En la parte superior derecha de la aplicación aparece una ventana con los diferentes pictogramas que se obtienen al buscar la palabra ``Perro''. Previamente, para poder realizar la búsqueda de pictogramas, se ha tenido que seleccionar el campo Pictos, que está a la izquierda de la barra de búsqueda. Si se hace clic en uno de ellos automáticamente se pondrá en el campo del editor.
			
			\begin{figure}[ht!]
				\begin{center}
					\includegraphics[width=0.84\textwidth]{Imagenes/Bitmap/buscarPictoProtoConjunto}
					\caption{Versión 1.0 de la búsqueda de pictogramas}
					\label{fig:buscarPictoProtoConjunto}
				\end{center}
			\end{figure}
			
			\item \textbf{Adaptación de actividades}: En la Figura \ref{fig:edicionActividadesProtoConjunto} se puede ver un ejemplo de una adaptación de una actividad. En este caso, el ejercicio es ``Completar'', es decir, completar el texto rellenando los huecos en blanco. Para ello, se ha tenido que seleccionar el menú Actividades (Figura \ref{fig:editorProtoConjunto}) y, de entre los distintos tipos de actividades que hay, seleccionar ``Completar''. Una vez elegido este apartado, habría que ir señalando en la parte de la izquierda las palabras en las que se quiera dejar el hueco, por lo que en la parte de la derecha (editor) saldría huecos en blanco en vez de la palabra señalada. Si se quiere cerrar este menú, bastaría con darle clic en la flecha que hay en la parte de la izquierda del menú.
			
			\begin{figure}[ht!]
				\begin{center}
					\includegraphics[width=0.84\textwidth]{Imagenes/Bitmap/edicionActividadesProtoConjunto}
					\caption{Versión 1.0 de la adaptación de actividades}
					\label{fig:edicionActividadesProtoConjunto}
				\end{center}
			\end{figure}
			
			\begin{figure}[ht!]
				\begin{center}
					\includegraphics[width=0.84\textwidth]{Imagenes/Bitmap/edicionTemarioProtoConjunto}
					\caption{Versión 1.0 de la adaptación de temario}
					\label{fig:edicionTemarioProtoConjunto}
				\end{center}
			\end{figure}
		
			\item \textbf{Adaptación de temario}: En la Figura \ref{fig:edicionTemarioProtoConjunto} se puede encontrar un ejemplo de una adaptación de temario. En este caso, la adaptación es ``Resumir texto''. Para ello, se ha tenido que seleccionar el menú Temario (Figura \ref{fig:editorProtoConjunto}). Una vez elegido este apartado, lo primero es seleccionar el texto que se quiera resumir en la parte izquierda y después habría que darle clic a ``Resumir texto'' para que salga, en la parte de la derecha, el texto resumido.
			
		\end{itemize}
	
	\subsection{Tercera iteración: iteración competitiva}
	\label{cap5:sec:diseño:subsec:tercera}
		Una vez que se hizo la versión 1.0 del prototipo, se propuso hacer una iteración competitiva para ver si este prototipo se podía mejorar. Cada miembro del equipo realizó, de forma individual y sin influir los unos en los otros, un prototipo propio partiendo del inicial. Con esto se consigue tener diferentes puntos de vista sobre una misma funcionalidad. Una vez que todos los prototipos fueron diseñados (dos de forma digital y otro en papel) se realizó una puesta en común para analizar las distintas propuestas. Los resultados fueron los siguientes:
		\begin{itemize}
			\item \textbf{Página principal}: En las Figuras \ref{fig:paginaInicialProtoJorge}, \ref{fig:paginaInicialProtoNatalia} y \ref{fig:paginaInicialProtoPablo} se puede observar los resultados de los tres prototipos para la página principal. En el caso de la Figura \ref{fig:paginaInicialProtoJorge}, en la parte inferior están los créditos y los logotipos de ARASAAC\footnote{https://arasaac.org/}, la Universidad Complutense de Madrid\footnote{https://www.ucm.es} y la licencia de \textit{Creative Commons}\footnote{https://creativecommons.org/}. También se observa que en la parte de la derecha de la barra de navegación se propuso hacer un sistema de \textit{login} para poder guardar el trabajo realizado.  Ésto último no resultó debido a que los usuarios finales que usen la aplicación especificaron que no querían recordar ningún nombre de usuario y contraseña. 
			
			\begin{figure}[ht!]
				\begin{center}
					\includegraphics[width=0.64\textwidth, angle=90]{Imagenes/Bitmap/paginaInicialProtoJorge}
					\caption{Prototipo de la página principal (Jorge)}
					\label{fig:paginaInicialProtoJorge}
				\end{center}
			\end{figure}
			
			\begin{figure}[ht!]
				\begin{center}
					\includegraphics[width=0.84\textwidth]{Imagenes/Bitmap/paginaInicialProtoNatalia}
					\caption{Prototipo de la página principal (Natalia)}
					\label{fig:paginaInicialProtoNatalia}
				\end{center}
			\end{figure}
		
			\begin{figure}[ht!]
				\begin{center}
					\includegraphics[width=0.84\textwidth]{Imagenes/Bitmap/paginaInicialProtoPablo}
					\caption{Prototipo de la página principal (Pablo)}
					\label{fig:paginaInicialProtoPablo}
				\end{center}
			\end{figure}
		
			También, en la parte inferior de dicha figura coincidimos que sería buena idea establecer algún botón, tal y como ocurre en las Figuras \ref{fig:paginaInicialProtoNatalia} (aquí se observa que hay dos botones: Créditos, que es donde iría la parte inferior de la Figura \ref{fig:paginaInicialProtoJorge}; y Ayuda, por si el usuario necesita algún tipo de ayuda con la aplicación) y \ref{fig:paginaInicialProtoPablo} (en este caso se ve tres botones: Inicio, que te llevaría a la página principal; Ayuda, donde se incluiría también la parte de Créditos; y Contacto, por si el usuario tiene algún problema y/o sugerencia pueda contactar con los desarrolladores y proporcionarle una respuesta).
		
			\item \textbf{Editor}: En las Figuras \ref{fig:editorProtoJorge}, \ref{fig:editorProtoNatalia} y \ref{fig:editorProtoPablo} se pueden ver los resultados de la página del editor. En el caso de las Figura \ref{fig:editorProtoJorge}, observamos una barra de navegación con diferentes menús, que representa los tipos de adaptaciones que tendrá en la aplicación (véase sección \ref{cap5:sec:capturaRequisitos:tiposAdaptaciones}), junto con la búsqueda de imágenes y pictogramas. Si se pasa el ratón por encima de uno de estos menús saldrá un desplegable con los distintos tipos de actividades, temario y formato que hay, tal y como se puede ver en la Figura \ref{fig:desplegableProtoJorge}. 
			
			\begin{figure}[ht!]
				\begin{center}
					\includegraphics[width=0.64\textwidth, angle=90]{Imagenes/Bitmap/editorProtoJorge}
					\caption{Prototipo del editor (Jorge)}
					\label{fig:editorProtoJorge}
				\end{center}
			\end{figure}
			
			\begin{figure}[ht!]
				\begin{center}
					\includegraphics[width=0.64\textwidth, angle=90]{Imagenes/Bitmap/desplegableProtoJorge}
					\caption{Prototipo del editor con un desplegable en uno de los menús (Jorge)}
					\label{fig:desplegableProtoJorge}
				\end{center}
			\end{figure}
		
			Así mismo, se ven dos elementos separados por un hueco: el elemento de la izquierda representa el fichero subido, y el de la derecha, el editor. Debajo de éste se encuentra un panel con unos botones para poder descargar, guardar y ver el documento editado, así como la posibilidad de poder borrar todo lo escrito en el editor (Vista Previa, que se puede ver en la Figura \ref{fig:vistaPreviaProtoJorge}, donde la opacidad del fondo está ligeramente oscurecida, y, en el centro, cómo quedaría lo escrito en el editor; Descargar, Guardar y Borrar todo).
			
			\begin{figure}[ht!]
				\begin{center}
					\includegraphics[width=0.64\textwidth, angle=90]{Imagenes/Bitmap/vistaPreviaProtoJorge}
					\caption{Prototipo de la vista previa (Jorge)}
					\label{fig:vistaPreviaProtoJorge}
				\end{center}
			\end{figure}
			
			En la Figura \ref{fig:editorProtoNatalia}, también existe esa barra de navegación con esos menús, aunque se cambia el logo de AdaptaMaterialEscolar por dichos menús, añadiendo el de Archivo y Formato. También tiene los dos elementos mencionados anteriormente: en la parte de la izquierda el documento subido, y en el de la derecha, el editor. En éste, se encuentra una barra de herramientas con la posibilidad de cambiar el formato de la letra, la posición del texto, y dos botones para descargar y borrar todo (representados por una cuadrado con una flecha apuntando hacia abajo, Descargar; y una papelera con una cruz en ella, Borrar todo). 
			
			\begin{figure}[ht!]
				\begin{center}
					\includegraphics[width=0.84\textwidth]{Imagenes/Bitmap/editorProtoNatalia}
					\caption{Prototipo del editor (Natalia)}
					\label{fig:editorProtoNatalia}
				\end{center}
			\end{figure}
		
			\begin{figure}[ht!]
				\begin{center}
					\includegraphics[width=0.84\textwidth]{Imagenes/Bitmap/editorProtoPablo}
					\caption{Prototipo del editor (Pablo)}
					\label{fig:editorProtoPablo}
				\end{center}
			\end{figure}
		
			En cambio, en la Figura \ref{fig:editorProtoPablo}, se observa que esa barra de navegación no está, sino que está incluida en el propio editor (el elemento que se encuentra en la parte de la izquierda). En esta barra de herramientas se podrá dar formato al texto (ponerle forma de título, párrafo, color, negrita, cursiva, etc), así como deshacer y rehacer lo escrito, crear tablas, y unos botones con los distintos tipos de adaptaciones que hay.
			
			
			
		\end{itemize}
	
	\subsection{Cuarta iteración: diseño final}
	\label{cap5:sec:diseño:subsec:cuarta}
		Una vez hecho la puesta en común de los diseños realizados por cada miembro del equipo se procedió a hacer el diseño final. Este diseño tomaba como base la Figura \ref{fig:editorProtoPablo}, debido a que estaba todo más limpio y claro visualmente, y a la que se le añadió una barra de navegación en la parte superior (tal y como aparece en las Figuras \ref{fig:editorProtoJorge} y \ref{fig:editorProtoNatalia}) para los tipos de adaptaciones que habrá en la aplicación. Esta barra de navegación surge porque algunas adaptaciones tienen un estilo de implementación distinto (algunas se podrán hacer sobre el propio editor pero otras abrirán nuevas ventanas para poder realizar la adaptación, sobre todo en las adaptaciones de actividades).
		
		Tras realizar este diseño, se envió un email a las profesoras del Aula TEA para que nos dieran \textit{feedback} sobre él. La respuesta fue positiva: tanto la distribución de los elementos como los colores usados eran adecuados. Así mismo, nos propusieron una nueva funcionalidad: permitir subrayar un texto con fluorescente.

%------Tercera sección: Implementación------%
\section{Implementación}
%-------------------------------------------%
\label{cap5:sec:implementacion}

	AdaptaMaterialEscolar es una aplicación web creada con React (ver sección \ref{cap3:sec:react}), cuyo código se puede encontrar en el repositorio del grupo NIL en GitHub\footnote{\url{https://github.com/NILGroup/TFG-AdaptaMaterialEscolar/tree/master/Codigo}}.
	
	Es accesible a través de la siguiente url: \url{https://holstein.fdi.ucm.es/tfg/2021/adapta/}. 
	
	En la Figura \ref{fig:adaptamaterialescolarInicio1} se muestra la página principal de la aplicación. En ella se puede ver el header en la parte superior, con el logo de la aplicación en la parte de la izquierda, y los botones de Inicio, Ayuda y Contacto en la parte de la derecha; y en el centro de la página una zona para poder subir el fichero \textit{.pdf}. Cuando éste se ha subido, aparecerán dos zonas diferenciadas: la zona de la izquierda contiene el documento subido y la zona de la derecha es la zona que contiene las funcionalidades y el editor con su barra de herramientas, como se puede ver en la Figura \ref{fig:adaptamaterialescolarInicio2}.
	
	\begin{figure}[ht!]
		\begin{center}
			\includegraphics[width=0.94\textwidth]{Imagenes/Bitmap/adaptamaterialescolarInicio1}
			\caption{Página principal de AdaptaMaterialEscolar}
			\label{fig:adaptamaterialescolarInicio1}
		\end{center}
	\end{figure}
	
	\begin{figure}[ht!]
		\begin{center}
			\includegraphics[width=0.94\textwidth]{Imagenes/Bitmap/adaptamaterialescolarInicio2}
			\caption{Página principal de AdaptaMaterialEscolar tras subir un documento}
			\label{fig:adaptamaterialescolarInicio2}
		\end{center}
	\end{figure}
	
	Las funcionalidades implementadas se darán con más detalle en la sección \ref{cap5:sec:funcionalidades} y son las siguientes:
	
	\begin{itemize}
		\item Pictogramas. Permite buscar pictogramas correspondientes al texto introducido. Haciendo clic en un pictograma hace que éste se lleve al editor.
		\item Completar huecos. Permite crear un ejercicio de completar con palabras los huecos, a partir de un texto inicial, haciendo clic en las palabras en las que se quiera dejar el hueco.
		\item Definiciones/Desarrollo. Definiciones permite crear una lista de conceptos a definir o preguntas a contestar en un número máximo de líneas. Desarrollo permite crear un ejercicio de desarrollo insertando el enunciado en un número de líneas máximo. En ambos, el número de líneas lo establece el usuario y también tiene una opción para añadir espaciado extra entre líneas para estudiantes que tengan una letra más grande.
		\item Sopa de letras. Permite crear una sopa de letras estableciendo el número de filas, columnas, las palabras que se quiere insertar y las direcciones cardinales para buscar la palabra. También se puede establecer la escritura al revés de cada palabra y mostrar en el ejercicio las palabras a buscar.
		\item Verdadero y falso. Permite crear una lista de oraciones y añade al final un recuadro para contestar con una V si es verdadero o con una F si es falso.
	\end{itemize}
	
	Todos los ejercicios tienen una opción para añadir un ejemplo de cómo resolver el ejercicio, y en todos ellos se añade un enunciado plantilla automáticamente, que posteriormente el usuario puede personalizar a su gusto.
	
	\begin{figure}[ht!]
		\begin{center}
			\includegraphics[width=0.84\textwidth]{Imagenes/Bitmap/adaptamaterialescolarMovible}
			\caption{Ejemplo de ventana movible}
			\label{fig:adaptamaterialescolarMovible}
		\end{center}
	\end{figure}

	Al hacer clic en una de las funcionalidades, se abrirá, justo debajo de la barra de funcionalidades, una ventana movible manteniendo el clic izquierdo pulsado en la parte superior de dicha ventana. En la Figura \ref{fig:adaptamaterialescolarMovible} se puede ver el mensaje que sale al pasar el ratón por encima de la parte superior de la ventana en el que informa al usuario de que puede moverla; y se ve que ésta se ha movido de sitio.
	
	%-----------------------------------%
	\subsection{Arquitectura}
	%-----------------------------------%
	\label{cap5:sec:arquitectura}
	En el proyecto de este TFG se ha decidido aplicar una arquitectura \textit{Redux}\footnote{\url{https://redux.js.org/}}. Redux es un patrón de arquitectura de datos que pretende disminuir el número de relaciones entre los componentes de la aplicación. Se trata de un patrón que se adapta a todo tipo de librería o framework del lado del cliente. La figura \ref{fig:flujoRedux} muestra un diagrama mostrando el flujo de una aplicación Redux. Dicho diagrama muestra un flujo unidireccional, donde las vistas se suscriben a los datos del Store y actualizan estos mediante acciones.
	\begin{figure}[ht!]
		\begin{center}
			\includegraphics[width=0.84\textwidth]{Imagenes/Bitmap/flujoRedux}
			\caption{Muestra de flujo en Redux}
			\label{fig:flujoRedux}
		\end{center}
	\end{figure} 
	
	Esta arquitectura se basa en tres principios:
	\begin{itemize}
		\item Única fuente de la verdad. El estado de la aplicación se guarda en un único store y cuando los componentes necesiten conocer el estado lo cogeran del store. Este store es un objeto Javascript y está estructurado en forma de árbol con todos los datos necesarios para la aplicación.
		\item El estado es de solo lectura. No podemos modificar el estado directamente, solo podremos leer de él para mostrarlo en la vista y si queremos modificarlo tendremos que ejecutar acciones. Las acciones son un objeto Javascript que incluye al menos un atributo type que indica el tipo de acción que estamos emitiendo y en caso de que haya datos asociados al cambio o modificación, un atributo payload con esos datos. Por ejemplo, en el siguiente fragmento de código se tiene una acción para cargar un documento, donde el atributo type indica el tipo de acción a realizar y el payload llevará los datos del documento a cargar:
		\begin{lstlisting}[language=Javascript, backgroundcolor=\color{lightgray}]
			export const loadDocument = (document) => ({
				type: DocumentActionTypes.LOAD_FILE,
				payload: document
			});
		\end{lstlisting}
		\item Cambios con funciones puras. Ya que el estado no se puede modificar directamente y está almacenado en un store, tenemos que ejecutar acciones puras llamadas \textit{reducers} para modificarlo. Un \textit{reducer} es una función que recibe dos parámetros, el estado inicial y una acción. Dentro contendrá un \textit{switch-case} que, en base a la acción que reciba, ejecutará los cambios necesarios en el store. Por ejemplo, en caso de recibir una acción del tipo LOAD\underline{ }FILE, almacenará el documento recibido del payload de la acción y lo guardará en el store. El siguiente fragmento muestra un reducer del módulo documentos dende gestiona la acción LOAD\underline{ }FILE:
		\begin{lstlisting}[language=Javascript, backgroundcolor=\color{lightgray}]
			const documentReducer = (state = INITIAL_STATE, action) => {
				switch (action.type){
					case DocumentActionTypes.LOAD_FILE: 
					return {
						...state,
						file: action.payload.file,
						fileIsLoaded: true
					};
					default: 
					return state;
				}
				
			};
		\end{lstlisting}
	\end{itemize}
	Al externalizar toda la información en un store, facilitamos el acceso y modificación de datos en la aplicación. En la figura \ref{fig:reduxVs} se muestran las diferencias de flujo de información entre los componentes de una aplicación web sin redux y otra con redux.
	
	\begin{figure}[ht!]
		\begin{center}
			\includegraphics[width=0.84\textwidth]{Imagenes/Bitmap/reduxvsnoredux}
			\caption{Comparación de flujo de información de componentes sin y con redux. Fuente: https://blog.codecentric.de/en/2017/12/developing-modern-offline-apps-reactjs-redux-electron-part-3-reactjs-redux-basics/}
			\label{fig:reduxVs}
		\end{center}
	\end{figure} 
	
	En redux, el flujo de datos es unidireccional (ver figura \ref{fig:flujoRedux}) y se siguen los siguientes pasos:
	\begin{itemize} 
		\item Los componentes se suscriben a los datos del store mediante selectores. Estos selectores actúan como \textit{getters}, es decir, funciones de solo lectura de datos. Cuando el store modifique uno de esos valores, los componentes a los que estén suscritos se actualizarán automáticamente. Se recurre a una librería de npm denominada \textit{reselect}\footnote{\url{https://www.npmjs.com/package/reselect}} que simplifica estas implementaciones. Mediante \textit{reselect} ejecutamos una función denominada \textit{createSelector}, que internamente realiza la suscripción al dato del store que queramos. En el siguiente fragmento se crea un selector para obtener el documento cargado en el store. Se selecciona el módulo document del store y creamos un selector que obtenga el fichero:
		\begin{lstlisting}[language=Javascript, backgroundcolor=\color{lightgray}]
			const selectDocumentStore = (store) => store.document;
			
			export const selectDocumentFile = createSelector(
			[selectDocumentStore],
			documentStore => documentStore.file
			);
		\end{lstlisting}
		En los componentes se inyectarán los selectors necesarios mediante una función llamada \textit{createStructuredSelector}. Por ejemplo, en el componente que muestra un documento:
		\begin{lstlisting}[language=Javascript, backgroundcolor=\color{lightgray}]
			const mapStateToProps = createStructuredSelector({
				document: selectDocumentFile
			});
		\end{lstlisting}
		\item Los componentes ejecutan acciones. Esto lo realizan ejecutando un método \textit{dispatch} y añadiendo como parámetro la acción a ejecutar. Por ejemplo, si tenemos una acción de cargar un documento, haríamos lo siguiente:
		\begin{lstlisting}[language=Javascript, backgroundcolor=\color{lightgray}]
			export const loadDocument = document => ({
				type: DocumentActionTypes.LOAD_FILE,
				payload: document
			});
		\end{lstlisting}
		
		\item Se ejecutan middlewares en caso de necesitar acciones asíncronas. Estos middlewares permiten ejecutar llamadas a API REST y posteriormente despachar otras acciones según el resultado. El siguiente ejemplo muestra cómo se ejecuta un middleware de buscar pictogramas llamando a la API de ARASAAC:
		\begin{lstlisting}[language=Javascript, backgroundcolor=\color{lightgray}]
			export const fetchPictogramsAction = (searchInput) => {
				return dispatch => {
					fetch("https://api.arasaac.org/api/pictograms/es/search/$\dollar${searchInput}")
					.then((response) => response.json())
					.then(data => {
						let items = [];
						for(let i = 0; i < data.length && i < 20; i++){
							items.push("https://static.arasaac.org/pictograms/$\dollar${data[i].\_id}/$\dollar${data[i].\_id}\_500.png")
						}
						dispatch(fetchPictogramsSuccess(items));
					})
					.catch(error){
						dispatch(fetchPictogramsFailure(error))        
					};
				}
			}
		\end{lstlisting}
		\item El store de redux invoca a la función reductora solicitada por la acción. El store le pasará dos argumentos a la función: estado actual y acción. El switch dentro del reductor encontrará la acción solicitada y actualizará los datos en base a ella. Los selectores detectarán el cambio y actualizarán las vistas.
	\end{itemize}


%-----------------------------------%
\subsection{Funcionalidades}
\label{cap5:sec:funcionalidades}
%-----------------------------------%
	En esta sección se explicarán con detalle la implementación de cada una de las funcionalidades.
	
	\subsubsection{Buscador de pictogramas}
	La figura \ref{fig:pictoModal} muestra la apariencia de la aplicación cuando se selecciona el buscador de pictogramas. En él, se muestra un único input donde se introduce el texto a buscar. La aplicación reaccionará automáticamente y mostrará los resultados conforme se vaya actualizando el texto a buscar. En la figura \ref{fig:pictoResults} se puede ver cómo se muestran los resultados una vez se ha introducido un texto de búsqueda.
	\begin{figure}[ht!]
		\begin{center}
			\includegraphics[width=0.84\textwidth]{Imagenes/Bitmap/pictoModal}
			\caption{Buscador de pictogramas de AdaptaMaterialEscolar}
			\label{fig:pictoModal}
		\end{center}
	\end{figure} 
		\begin{figure}[ht!]
		\begin{center}
			\includegraphics[width=0.84\textwidth]{Imagenes/Bitmap/pictoResults}
			\caption{Resultados del buscador de pictogramas}
			\label{fig:pictoResults}
		\end{center}
	\end{figure} 
			\begin{figure}[ht!]
		\begin{center}
			\includegraphics[width=0.84\textwidth]{Imagenes/Bitmap/pictoEditor}
			\caption{Pictograma introducido en el editor}
			\label{fig:pictoEditor}
		\end{center}
	\end{figure} 
	Una vez se ha introducido el texto, se selecciona el pictograma deseado y se hace click sobre él para introducirlo en el editor. La figura \ref{fig:pictoEditor} contiene el aspecto del editor una vez se ha introducido un pictograma.
	Internamente, este módulo contiene tres valores: searchResults, inputText y errorText. El inputText contiene el texto del formulario de búsqueda, cada vez que se actualice la vista \textit{PictogramSearchModal} ejecutará una acción \textit{FetchPictogramsAction}, la cual realizará la llamada a la API externa de ARASAAC y obtendrá los pictogramas. Como esta acción ejecuta una llamada a una API externa, tiene un carácter asíncrono y actúa como middleware entre acciones. En la acción se ejecutará un fetch a la url de ARASAAC, si todo va bien se obtendrán los datos y se ejecutará otra acción llamada \textit{FetchPictogramsSuccess} que actualizará el Store con los datos obtenidos y automáticamente actualizará la interfaz con los resultados. Si se ha producido cualquier error de conexión se ejecutará una acción llamada \textit{FetchPictogramsFailure} donde se almacenará el error y se comunicará en la vista.
	
	Las figuras \ref{fig:pictoClase} y \ref{fig:pictoSecuencia} muestran el diagrama de clases y secuencias asociados a este caso de uso.
	\begin{figure}[ht!]
		\begin{center}
			\includegraphics[width=0.74\textwidth]{Imagenes/Bitmap/pictogramClassDiagram}
			\caption{Diagrama de clases del buscador de pictogramas}
			\label{fig:pictoClase}
		\end{center}
	\end{figure} 
	\begin{figure}[ht!]
		\begin{center}
			\includegraphics[width=0.84\textwidth]{Imagenes/Bitmap/pictosSecuencia}
			\caption{Diagrama de secuencia del buscador de pictogramas}
			\label{fig:pictoSecuencia}
		\end{center}
	\end{figure} 
	
	\subsubsection{Sopa de letras}
	En la Figura \ref{fig:wordsearchConfig} se puede ver el aspecto de la aplicación al seleccionar sopa de letras. La creación del ejercicio de sopa de letras solicita los siguientes parámetros:
	\begin{figure}[ht!]
		\begin{center}
			\includegraphics[width=0.8\textwidth]{Imagenes/Bitmap/wordsearchConfig}
			\caption{Generación de la sopa de letras en AdaptaMaterialEscolar}
			\label{fig:wordsearchConfig}
		\end{center}
	\end{figure}
	\begin{itemize}
		\item Filas: El número de filas que tendrá la sopa de letras. 
		\item Columnas: El número de columnas que tendrá la sopa de letras.
		\item Palabras: Las palabras que se insertarán en la sopa de letras.
		\item Dirección: Las direcciones en las que se quiere insertar la palabra. Como mínimo se debe activar una dirección para poder generar la sopa de letras.
	\end{itemize}
	
	También se ha añadido otra opción de carácter no obligatorio:
	\begin{itemize}
		\item Activar escritura al revés: Activa la probabilidad de escribir cada palabra al revés. En el caso de que esta opción no se active, la probabilidad será cero. Si se activa, aparecerá una barra deslizante para establecer dicha probabilidad.
	\end{itemize}
	
	Así mismo, existe otra opción de carácter opcional no relacionada con la creación de la sopa de letras y es la posibilidad de mostrar en el editor las palabras a buscar junto al enunciado.
	
	Una vez que se han rellenado los campos obligatorios (filas, columnas, palabras y dirección) se activarán los botones de ``Vista previa'' y ``Aceptar''. El botón Vista previa genera primero la sopa de letras y la muestra al usuario antes de escribirla en el editor (en la Figura \ref{fig:wordsearchPreview} se muestra la vista previa de la sopa de letras usando la configuración de la Figura \ref{fig:wordsearchConfig}). En cambio, el botón Aceptar genera la sopa de letras y la escribe directamente en el editor, sin mostrarla antes al usuario. En ambos casos, si ocurre algún error (por ejemplo, que el número de filas y columnas sea igual o menor que cero) se mostrará al usuario el mensaje de error correspondiente. 
	
	\begin{figure}[ht!]
		\begin{center}
			\includegraphics[width=0.7\textwidth]{Imagenes/Bitmap/wordsearchPreview}
			\caption{Vista previa de la sopa de letras}
			\label{fig:wordsearchPreview}
		\end{center}
	\end{figure}
	
	En la Figura \ref{fig:wordsearchSequence} se muestra el diagrama de secuencia de esta funcionalidad. Tal y como puede verse en dicho diagrama, al pulsar aceptar ocurre lo siguiente:
	\begin{figure}[ht!]
		\begin{center}
			\includegraphics[width=1\textwidth]{Imagenes/Bitmap/wordsearchSequence}
			\caption{Diagrama de secuencia de la generación de la sopa de letras}
			\label{fig:wordsearchSequence}
		\end{center}
	\end{figure}
	\begin{enumerate}
		\item Se hace una llamada al despachador pasándole como acción \textit{updateForceReadyToPreview(false)}, para ocultar la vista previa en caso de que esté visible.
		\item Hay que distinguir dos casos fundamentales:
		\begin{itemize}
			\item Si ya hay una sopa de letras creada, es decir, el objeto WordSearchObject es distinto de null, significa que anteriormente se ha pulsado el botón de Vista Previa, o el botón Aceptar pero hay un error. En este caso, si hay un mensaje de error se hace una llamada a \textit{generateWordSearch()}.
			\item Si no hay una sopa de letras creada, es decir, el objecto WordSearchObject es null, llamaremos directamente a \textit{generateWordSearch()}.
		\end{itemize}
		\item La función \textit{generateWordSearch()} consta de dos fases:
		\begin{enumerate}
			\item Se llama al despachador pasándole como acción \textit{createWordSearch()}. El despachador buscará en \textit{Actions} el tipo de acción que es (en este caso, \textit{CREATE\_WORDSEARCH}). Posteriormente llamará al reductor a través de \textit{wordSearchRedutor()}, pasándole como parámetros el estado (\textit{state}) del componente y la acción buscada anteriormente. A continuación, buscará en el \textit{switch} el tipo de acción y se procederá a crear la sopa de letras llamando a \textit{createWordSearch()} pasándole como parámetros el objeto wordSearchObject y el objeto de configuración de la sopa de letras, \textit{options}. Esta función devolverá una sopa de letras en caso de que las filas y columnas sean mayores que cero. En caso contrario, o si ha habido alguna excepción, devolverá null. En la Figura \ref{fig:flujoCreateWordSearch} se puede ver un diagrama con el flujo de acción, reductor, etc., concretos para este caso.
			\begin{figure}[ht!]
				\begin{center}
					\includegraphics[width=0.7\textwidth]{Imagenes/Bitmap/flujoCreateWordSearch}
					\caption{Diagrama de flujo de la generación de la sopa de letras}
					\label{fig:flujoCreateWordSearch}
				\end{center}
			\end{figure}
			\item Se llama al despachador pasándole como acción \textit{updateError()}. El despachador buscará en \textit{Actions} el tipo de acción que es (que en este caso es \textit{UPDATE\_WORDSEARCH\_ERROR}). Después llamará al reductor donde buscará el tipo de acción en el \textit{switch} y actualizará el mensaje de error llamando a la función \textit{manageError()} pasándole como parámetros el error, el objeto wordSearchObject y la longitud del array \textit{dictionary}. El error solo puede tomar tres estados:
			\begin{itemize}
				\item Si el objeto wordSearchObject es null, el error será ``Las filas y columnas deben tener un valor positivo mayor que 0''.
				\item Si el objeto wordSearchObject es distinto a null:
				\begin{itemize}
					\item Hay que ver si la longitud de words (una de las funciones de la sopa de letras, que se puede leer en la sección \ref{cap3:sec:wordsearch}) es menor que la longitud del array \textit{dictionary}. En este caso, el error será ``No todas las palabras introducidas están en la sopa de letras. Prueba a cambiar el valor de las filas, columnas y/o número máximo de palabras''.
					\item En caso contrario, no habrá mensaje de error.
				\end{itemize}
			\end{itemize}
		\end{enumerate}
		\item Por último, se hará una llamada a \textit{writeInEditor()}, una función local de \textit{WordSearchModal}, cuyo objetivo es escribir en el editor la sopa de letras, además de resetear los datos del modal y cerrarlo.
	\end{enumerate}

	En la Figura \ref{fig:wordsearchResult} se muestra el resultado de la generación de la sopa de letras si se usa como configuración los datos de la Figura \ref{fig:wordsearchConfig}.

	\begin{figure}[ht!]
		\begin{center}
			\includegraphics[width=0.7\textwidth]{Imagenes/Bitmap/wordsearchResult}
			\caption{Resultado de la generación de la sopa de letras}
			\label{fig:wordsearchResult}
		\end{center}
	\end{figure}
	
	\subsubsection{Definiciones/Preguntas}
	
	Esta opción inicialmente fue pensada para permitir añadir ejercicios para que los estudiantes pudieran definir conceptos, pero durante la implementación vimos la opción de aumentar la funcionalidad planteando otros tipos de ejercicios, como, por ejemplo, preguntas cortas para que el alumnado tenga que responder argumentando.
	
	Al seleccionar esta opción en nuestra aplicación se muestra la interfaz de la Figura \ref{fig:definitionsOptions1}. Para crear este tipo de ejercicio, hay que rellenar los siguientes campos:
	\begin{figure}[ht!]
		\begin{center}
			\includegraphics[width=0.7\textwidth]{Imagenes/Bitmap/definitionsOptions1}
			\caption{Interfaz del ejercicio de definiciones/preguntas}
			\label{fig:definitionsOptions1}
		\end{center}
	\end{figure}
	\begin{itemize}
		\item Conceptos a definir o preguntas a contestar: Es un array de strings que inicialmente está vacío, y contiene los conceptos a definir y/o preguntas a contestar. Dentro de los inputs, si se pulsa a la tecla enter, se podrá introducir más conceptos o preguntas (también se puede hacer clic en el botón ``más'' para añadir. Para quitar alguna fila, se tendrá que hacer clic en el botón ``menos'').
		\item Número de líneas: número máximo de líneas para definir el concepto o contestar la pregunta. Por defecto es 1.
		\item La forma en la que se muestra las frases: puede mostrarse como una lista no ordenada o una lista ordenada. Por defecto está establecido en mostrarse como una lista no ordenada.
	\end{itemize}
	
	Así mismo, se ha incluido una opción para añadir espacio extra entre líneas para los estudiantes que tengan una letra más grande.

	Una vez que se han rellenado los campos obligatorios, el botón Aceptar se habilitará. Al hacer clic en él se procederá a escribir en el editor cada concepto y/o pregunta, seguido del número de líneas especificado por el usuario. Así mismo, se reseteará el modal y se cerrará. En la Figura \ref{fig:definitionsResult} se muestra el resultado de este ejercicio al usar las opciones de la Figura \ref{fig:definitionsOptions1} en la parte superior. La parte inferior es el resultado de usar las opciones de la Figura \ref{fig:definitionsOptions2}
	
	\begin{figure}[ht!]
		\begin{center}
			\includegraphics[width=0.7\textwidth]{Imagenes/Bitmap/definitionsOptions2}
			\caption{Interfaz del ejercicio de definiciones/preguntas con espacio extra activado}
			\label{fig:definitionsOptions2}
		\end{center}
	\end{figure}

	\begin{figure}[ht!]
		\begin{center}
			\includegraphics[width=0.7\textwidth]{Imagenes/Bitmap/definitionsResult}
			\caption{Resultado del ejercicio de definiciones/preguntas usando las opciones de las Figuras \ref{fig:definitionsOptions1} y \ref{fig:definitionsOptions2}}
			\label{fig:definitionsResult}
		\end{center}
	\end{figure}

	\subsubsection{Pregunta para desarrollar}
	
	El ejercicio pregunta para desarrollar tiene como finalidad permitir que se inserte en el editor de texto un enunciado que pregunte al alumno sobre teoría, de forma que tenga que argumentar su respuesta de manera más extensa.
	
	La interfaz de este ejercicio se puede ver en la Figura \ref{fig:developOptions}. Para crear el ejercicio, hace falta escribir el enunciado y elegir el número de líneas máximo para desarrollarlo. Así mismo, se ha incluido una opción no obligatoria para añadir espacio extra entre líneas en caso de que algún estudiante tenga un tamaño de letra mayor. 
	
	\begin{figure}[ht!]
		\begin{center}
			\includegraphics[width=0.7\textwidth]{Imagenes/Bitmap/developOptions}
			\caption{Interfaz del ejercicio pregunta para desarrollar}
			\label{fig:developOptions}
		\end{center}
	\end{figure}
	
	Una vez que se han rellenado los campos obligatorios, el botón Aceptar se habilitará. Al hacer clic en él se procederá a escribir, en el editor, el enunciado del ejercicio y en los siguientes renglones el número de líneas especificado por el usuario. También se reseteará los datos del ejercicio y se cerrará el modal. En la Figura \ref{fig:developResult} se muestra el resultado de este ejercicio. En la parte superior se muestra dicho resultado usando las opciones de la Figura \ref{fig:developOptions}. En la parte inferior, el mismo ejercicio pero quitando la opción de añadir el ejemplo de cómo resolver el ejercicio, y añadiendo espacio extra entre líneas.
	
	\begin{figure}[ht!]
		\begin{center}
			\includegraphics[width=0.7\textwidth]{Imagenes/Bitmap/developResult}
			\caption{Resultado de ejercicio pregunta para desarrollar}
			\label{fig:developResult}
		\end{center}
	\end{figure}
	
	\subsubsection{Verdadero o Falso}
	
	La opción Verdadero o Falso sirve para plantear ejercicios en los que el alumnado tenga que indicar si un predicado es verdadero o falso, escribiendo en el recuadro una V si es verdadero o una F si es falso.
	
	Al seleccionar esta opción en nuestra aplicación, se muestra la interfaz de la Figura \ref{fig:truefalseOptions}. Para crear un ejercicio de verdadero y falso se necesitan rellenar los siguientes campos:
	\begin{itemize}
		\item Frases: es un array de strings que inicialmente está vacío, y contendrá las frases del ejercicio. Hay que escribir una frase en cada input de texto (para añadir más inputs, se puede pulsar la tecla enter dentro de uno de los inputs, o pulsar el botón ``más'' al lado de éste. Para quitarlos, se tendrá que hacer clic en el ``menos'').
		\item La forma para mostrarla: puede ser como una lista no ordenada o una lista ordenada. Por defecto está seleccionada la lista no ordenada.
	\end{itemize}

	\begin{figure}[ht!]
		\begin{center}
			\includegraphics[width=0.7\textwidth]{Imagenes/Bitmap/truefalseOptions}
			\caption{Interfaz del ejercicio Verdadero o Falso}
			\label{fig:truefalseOptions}
		\end{center}
	\end{figure}
	
	Una vez que se han rellenado los campos obligatorios mencionados anteriormente, el botón Aceptar se habilitará. Al hacer clic en él se procederá a escribir en el editor cada frase, seguido de un recuadro para escribir V si es verdadero o F si es falso, y se procederá a resetear los datos del modal y a cerrarlo. En la Figura \ref{fig:truefalseResult} se muestra el resultado del ejercicio usando las opciones de la Figura \ref{fig:truefalseOptions}.
	
	\begin{figure}[ht!]
		\begin{center}
			\includegraphics[width=0.7\textwidth]{Imagenes/Bitmap/truefalseResult}
			\caption{Resultado de ejercicio Verdadero o Falso}
			\label{fig:truefalseResult}
		\end{center}
	\end{figure}
	
	\subsubsection{Completar huecos}
	
	El ejercicio de rellenar huecos tiene como finalidad escribir las palabras faltantes en los espacios en los que haya una línea. Al seleccionar esta opción en nuestra aplicación se muestra la interfaz de la Figura \ref{fig:fillgapsOptions}. Este ejercicio consta de dos fases:
	\begin{figure}[ht!]
		\begin{center}
			\includegraphics[width=0.7\textwidth]{Imagenes/Bitmap/fillgapsOptions}
			\caption{Interfaz de edición del ejercicio rellenar huecos}
			\label{fig:fillgapsOptions}
		\end{center}
	\end{figure}
	\begin{itemize}
		\item En la primera fase hay que insertar el texto en el que se quiera quitar palabras. Una vez que se ha insertado, el botón Seleccionar palabras se habilitará.
		\item La segunda fase se alcanza cuando se hace clic en el botón de Seleccionar palabras. Para quitar una palabra basta con hacer clic en ella. Si se quiere volver a ver la palabra, hay que volver a hacer clic en ella. Para volver a editar el texto (volver a la fase uno), simplemente hay que hacer clic en el botón Editar texto. En la Figura \ref{fig:fillgapsSelection} se puede ver la interfaz de selección de las palabras. En ésta, se han seleccionado las palabras ``vivos'', ``plantas'' y ``orgánicas''.
	\end{itemize}
	
	\begin{figure}[ht!]
		\begin{center}
			\includegraphics[width=0.7\textwidth]{Imagenes/Bitmap/fillgapsSelection}
			\caption{Interfaz de selección de palabras del ejercicio rellenar huecos}
			\label{fig:fillgapsSelection}
		\end{center}
	\end{figure}
	
	Una vez que se ha seleccionado al menos una palabra, el botón Aceptar se habilitará. Al hacer clic en éste, se escribirá, en el editor, el texto modificado. En el enunciado del ejercicio se mostrará las palabras que se han escondido. Así mismo, se reseteará el modal y se cerrará. En la Figura \ref{fig:fillgapsResult} se ve el resultado del ejercicio al usar las opciones de las Figuras \ref{fig:fillgapsOptions} y \ref{fig:fillgapsSelection}.
	
	\begin{figure}[ht!]
		\begin{center}
			\includegraphics[width=0.7\textwidth]{Imagenes/Bitmap/fillgapsResult}
			\caption{Resultado del ejercicio de rellenar huecos}
			\label{fig:fillgapsResult}
		\end{center}
	\end{figure}

\subsection{Estructura del código}
%-----------------------------------%
\label{cap7:sec:estructura}

	La organización de directorios del proyecto gira en torno al patrón de diseño Redux, como se ha explicado en la sección \ref{cap5:sec:arquitectura} de este mismo capítulo.
	
	El código de la funcionalidad de la aplicación se estructura principalmente en cuatro carpetas: components, pages, ckeditor y redux; además, contamos con el fichero App, que supone el punto de inicio del programa.
	
	El contenido de cada carpeta es el siguiente:
	\begin{itemize}
		\item \textbf{Components:} Representado en la Figura \ref{fig:srcComponents}, contiene cada componente que representa una funcionalidad para la aplicación, o parte de ella, y todos cuentan, como mínimo, con los siguientes ficheros:
		\begin{itemize}
			\item Fichero modal de la funcionalidad del componente.
			\item Fichero que realiza las modificaciones pertinentes para ejecutar la funcionalidad.
			\item Fichero de estilo del componente.
		\end{itemize}
	\end{itemize}
	\begin{figure}[ht!]
		\begin{center}
			\includegraphics[width=0.25\textwidth]{Imagenes/Bitmap/srcComponents}
			\caption{Ejemplo de organización de Components}
			\label{fig:srcComponents}
		\end{center}
	\end{figure}
	
	Uno de los componentes más importantes es el de la barra de herramientas (\textit{Toolbar}), que sirve como hilo conductor de la selección de los diferentes tipos de adaptaciones que pueden agregarse al documento, mediante el patrón de diseño del despachador (\textit{dispatcher}).
	
	\begin{itemize}
		\item \textbf{Pages:} Representado en la Figura \ref{fig:srcPages}, contiene la página del editor, que permite cargar un fichero inicial para comenzar la adaptación, y la página de ayuda, que muestra información relevante sobre la aplicación y su uso. En los dos casos se cuenta con:
		\begin{itemize}
			\item Fichero de funcionalidad de la página.
			\item Fichero de estilo de la página.
		\end{itemize}
	\end{itemize}
	\begin{figure}[ht!]
		\begin{center}
			\includegraphics[width=0.22\textwidth]{Imagenes/Bitmap/srcPages}
			\caption{Ejemplo de organización de Pages}
			\label{fig:srcPages}
		\end{center}
	\end{figure}
	\begin{itemize}
		\item \textbf{Redux:} Representado en la Figura \ref{fig:srcRedux}, contiene la implementación del patrón de diseño que se ha aplicado a toda la aplicación, basado en el almacenamiento de los datos que necesita cada componente. La carpeta consta del store y el reducer, elementos necesarios para el desarrollo del mismo. Además, se incluye también cada componente principal con los siguientes ficheros:
		\begin{itemize}
			\item Fichero action: controla las diferentes acciones que puede ejecutar cada componente.
			\item Fichero reducer: controla el estado de los componentes según el tipo de acción que realicen, partiendo de un estado inicial.
			\item Fichero selectors: devuelve el valor de los atributos de cada componente.
			\item Fichero types: contiene un listado de acciones posibles para cada componente. 
		\end{itemize}
	\end{itemize}
	\begin{figure}[ht!]
		\begin{center}
			\includegraphics[width=0.4\textwidth]{Imagenes/Bitmap/srcRedux}
			\caption{Ejemplo de organización de Redux}
			\label{fig:srcRedux}
		\end{center}
	\end{figure}
	\begin{itemize}
		\item \textbf{CKEditor:} Representado en la Figura \ref{fig:srcCkeditor},contiene todos componentes software o plugins que se han desarrollado para la aplicación, permitiendo la interacción a partir de comandos que controlan las diferentes funcionalidades. Consta de un fichero que devuelve la instancia del editor CKeditor5 y una carpeta para cada plugin, con los siguientes archivos:
		\begin{itemize}
			\item Fichero de implementación del plugin.
			\item Fichero de inserción del plugin mediante el patrón de diseño de comando (\textit{command}).
		\end{itemize}
	\end{itemize}
	\begin{figure}[ht!]
		\begin{center}
			\includegraphics[width=0.4\textwidth]{Imagenes/Bitmap/srcCkeditor}
			\caption{Ejemplo de organización de CKEditor}
			\label{fig:srcCkeditor}
		\end{center}
	\end{figure}
